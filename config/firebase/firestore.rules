rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ðŸš¨ TEMPORARY: Allow all reads/writes for authenticated users
    // This fixes internal assertion failures while we debug
    match /{document=**} {
      allow read, write: if request.auth != null;
      allow read: if true; // Allow public reads for now
    }

    // âœ… PLATFORM SETTINGS
    match /platform_settings/{settingId} {
      allow read: if true; // Public read for platform settings
      allow write: if request.auth != null; // Admin can write
    }

    // âœ… FEATURED PROPERTIES
    match /featured_properties/{propertyId} {
      allow read: if true; // Public read
      allow write: if request.auth != null; // Authenticated write
    }

    // âœ… CONVERSATIONS
    match /conversations/{conversationId} {
      allow read, write: if request.auth != null &&
        request.auth.uid in resource.data.participants;
      allow create: if request.auth != null;
    }

    // âœ… MESSAGES
    match /messages/{messageId} {
      allow read, write: if request.auth != null;
    }

    // âœ… AGREEMENTS
    match /agreements/{agreementId} {
      allow read, write: if request.auth != null;
    }

    // âœ… TRANSACTIONS
    match /transactions/{transactionId} {
      allow read, write: if request.auth != null;
    }

    // âœ… RATE LIMITING
    match /rate_limits/{limitId} {
      allow read, write: if request.auth != null;
    }

    // âœ… ERROR LOGS
    match /error_logs/{errorId} {
      allow read, write: if request.auth != null;
    }

    // âœ… FALLBACK (allow authenticated reads for any other collections)
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}